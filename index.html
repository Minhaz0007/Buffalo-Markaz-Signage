<!DOCTYPE html>
<!--
  background-color on <html> (not just <body>) ensures the navy background
  is painted by the browser BEFORE any CSS or JS loads, preventing the
  momentary green/white compositor flash that appears when Chrome's GPU
  layer is empty during a page reload.
-->
<html lang="en" style="background-color:#0B1E3B;">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="build-version" content="BUILD_TIMESTAMP" />
    <!--
      theme-color tells the Chrome compositor (including Chromecast/AirPlay/HDMI
      tab-capture pipeline) what colour to use for the browser UI and any
      bare compositor frames that appear during page navigation, minimising the
      green flash that occurs when the GPU compositor layer empties mid-reload.
    -->
    <meta name="theme-color" content="#0B1E3B" />
    <title>Buffalo Markaz Masjid Signage</title>

    <!--
      CHUNK-LOAD GUARD — must run synchronously before any module loads.
      When Vercel deploys, old JS chunk filenames (with old content hashes)
      no longer exist. If the running page tries to load one → 404 → React
      crashes → Chrome compositor flashes green.
      This handler catches the failure immediately and reloads before React
      has a chance to crash, keeping the screen navy throughout.
    -->
    <script>
      (function () {
        function isChunkError(msg) {
          return (
            msg && (
              msg.indexOf('Failed to fetch dynamically imported module') !== -1 ||
              msg.indexOf('Importing a module script failed') !== -1 ||
              msg.indexOf('error loading dynamically imported module') !== -1 ||
              msg.indexOf('ChunkLoadError') !== -1
            )
          );
        }
        // Synchronous script errors (rare for ES modules but covers edge cases)
        window.addEventListener('error', function (e) {
          if (isChunkError(e.message)) {
            console.warn('[SignageGuard] Chunk load failure detected — reloading.');
            window.location.reload();
          }
        });
        // Unhandled promise rejections — the primary path for dynamic import failures
        window.addEventListener('unhandledrejection', function (e) {
          var msg = (e.reason && (e.reason.message || e.reason.toString())) || '';
          if (isChunkError(msg)) {
            console.warn('[SignageGuard] Chunk load failure (promise) — reloading.');
            e.preventDefault(); // suppress console error
            window.location.reload();
          }
        });
      })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              mosque: {
                navy: '#0B1E3B',
                gold: '#D4AF37',
                cream: '#F5F5DC',
                light: '#E2E8F0',
                dark: '#0f172a'
              }
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              serif: ['Amiri', 'serif'],
            }
          }
        }
      }
    </script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #0B1E3B;
      }

      /* Performance-optimized animations - defined once globally */
      @keyframes scroll {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
      }

      .animate-scroll {
        animation: scroll linear infinite;
        will-change: transform;
        /* Critical optimizations for 60Hz smooth scrolling */
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        transform-style: preserve-3d;
        -webkit-transform-style: preserve-3d;
        /* Prevent sub-pixel rendering blur */
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
        /* Font rendering optimization */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
        /* Force hardware acceleration */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
      }

      @keyframes subtle-pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.85; transform: scale(0.99); }
      }

      .animate-subtle-pulse {
        animation: subtle-pulse 4s ease-in-out infinite;
      }

      @keyframes textPulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(0.95); }
      }

      @keyframes textBlink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
      }

      @keyframes text-shine {
        0% { background-position: 0% 50%; }
        100% { background-position: 100% 50%; }
      }

      @keyframes gradient-text {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      .animate-text-pulse { animation: textPulse 1.5s infinite ease-in-out; }
      .animate-text-blink { animation: textBlink 1s infinite steps(1); }
      .animate-text-shine { animation: text-shine 3s linear infinite; }
      .animate-gradient-text { animation: gradient-text 3s ease infinite; }
      .bg-300% { background-size: 300% 300%; }

      /* GPU acceleration for animated elements */
      .gpu-accelerated {
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        perspective: 1000px;
        -webkit-perspective: 1000px;
        transform-style: preserve-3d;
        -webkit-transform-style: preserve-3d;
      }

      /* Optimized container for smooth scrolling ticker */
      .ticker-container-optimized {
        /* Ensure smooth rendering */
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        /* Force GPU compositing */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        /* Prevent layout shifts */
        contain: layout style paint;
        /* Optimize font rendering */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>
